# -*- coding: utf-8 -*-
from __future__ import unicode_literals
from django.shortcuts import render
from django.http import JsonResponse
from report.models import *
from utils import report_handle

def report(request, app_name):
    sensitive_list = report_handle.list_sniffgit_file(app_name)

    return render(request, 'report.html', {
        'app_name': app_name,
        'sensitive_list' : sensitive_list
    })


def report_data(request, app_name):    
    data = {
        'high': [
            ReportQark.objects.filter(severity='VULNERABILITY').filter(app_name=app_name).count(),
            ReportDc.objects.filter(severity='HIGH').filter(app_name=app_name).count(), 
            ReportAndro.objects.filter(severity='Critical').filter(app_name=app_name).count()
        ], 
        'medium': [
            ReportQark.objects.filter(severity='WARNING').filter(app_name=app_name).count(),
            ReportDc.objects.filter(severity='MEDIUM').filter(app_name=app_name).count(),
            ReportAndro.objects.filter(severity='Warning').filter(app_name=app_name).count()
        ], 
        'low': [
            ReportQark.objects.filter(severity='INFO').filter(app_name=app_name).count(),
            ReportDc.objects.filter(severity='LOW').filter(app_name=app_name).count(),
            ReportAndro.objects.filter(severity='Info').filter(app_name=app_name).count()
        ]        
    }
    return JsonResponse(data)