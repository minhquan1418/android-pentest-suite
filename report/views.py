# -*- coding: utf-8 -*-
from __future__ import unicode_literals
from django.shortcuts import render
from django.http import JsonResponse
from report.models import *
from utils import report_handle

def report(request, app_name):
    sensitive_list = report_handle.list_sniffgit_file(app_name)

    return render(request, 'report.html', {
        'app_name': app_name,
        'sensitive_list' : sensitive_list
    })


def report_data(request, app_name):
    andro_severity = report_handle.count_andro_severity(app_name)
    
    data = {
        'high': [
            ReportQark.objects.filter(severity='VULNERABILITY').count(),
            ReportDc.objects.filter(severity='HIGH').count(), 
            andro_severity[0]
        ], 
        'medium': [
            ReportQark.objects.filter(severity='WARNING').count(),
            ReportDc.objects.filter(severity='MEDIUM').count(),
            andro_severity[1]
        ], 
        'low': [
            ReportQark.objects.filter(severity='INFO').count(),
            ReportDc.objects.filter(severity='LOW').count(),
            andro_severity[2]
        ]        
    }
    return JsonResponse(data)